services:
  app:
    build:
      context: .. # repo root
      dockerfile: .devcontainer/Dockerfile
    volumes:
      - ..:/workspaces/elepad:cached
      - /var/run/docker.sock:/var/run/docker.sock # allow supabase CLI to start containers
    command: sleep infinity
    environment:
      DATABASE_URL: postgres://elepad:elepad@db:5432/elepad
      EXPO_USE_DEV_SERVER: "1"
      ANDROID_SDK_ROOT: /opt/android-sdk
      ANDROID_HOME: /opt/android-sdk
      JAVA_HOME: /usr/lib/jvm/java-17-openjdk-amd64
    extra_hosts:
      - "host.docker.internal:host-gateway" # reach host-published ports from container
    # Agregar un '2' al inicio de cada puerto para evitar conflictos
    ports:
      - "28081:8081" # React Native Metro
      - "28787:8787" # Hono API
      - "29000:19000" # Expo DevTools (UI)
      - "29001:19001" # Expo Debug (LAN)
      - "29002:19002" # Expo DevTools (WS)
